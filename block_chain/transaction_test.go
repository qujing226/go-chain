package chain

import (
	"testing"
)

func TestTransaction_Verify(t *testing.T) {
	type args struct {
		prevTXs map[string]Transaction
	}
	tests := []struct {
		name      string
		ID        []byte
		Vin       []TXInput
		Vout      []TXOutput
		TimeStamp int64
		Payload   []string
		want      bool
	}{
		{
			name: "test",
			ID:   []byte{148, 4, 233, 44, 128, 20, 98, 94, 130, 21, 151, 171, 62, 163, 53, 174, 46, 138, 38, 19, 104, 123, 107, 216, 206, 69, 118, 14, 168, 89, 26, 65},
			Vin: []TXInput{
				{
					Txid:      []byte{242, 57, 35, 213, 209, 237, 64, 131, 116, 252, 74, 144, 101, 18, 91, 80, 151, 242, 41, 186, 34, 238, 194, 73, 222, 217, 32, 118, 58, 213, 201, 1},
					Vout:      0,
					Signature: []byte{109, 99, 197, 4, 231, 214, 217, 170, 247, 76, 10, 101, 19, 225, 206, 177, 192, 35, 196, 119, 130, 245, 124, 71, 166, 180, 180, 40, 102, 52, 146, 105, 204, 60, 59, 216, 189, 60, 103, 19, 97, 239, 169, 145, 241, 28, 72, 96, 73, 232, 144, 126, 239, 57, 161, 120, 75, 147, 119, 209, 40, 173, 62, 28},
					PubKey:    []byte{107, 50, 194, 81, 63, 40, 4, 7, 20, 102, 136, 74, 254, 30, 229, 101, 14, 147, 16, 101, 60, 93, 62, 168, 24, 152, 116, 113, 150, 200, 211, 218, 166, 160, 233, 141, 5, 186, 252, 123, 199, 95, 106, 34, 143, 167, 169, 148, 154, 49, 7, 252, 11, 2, 218, 135, 244, 73, 206, 184, 231, 157, 214, 78},
				},
			},
			Vout: []TXOutput{
				{
					Value:      3,
					PubKeyHash: []byte{187, 200, 241, 71, 145, 23, 162, 139, 36, 63, 27, 34, 107, 61, 87, 160, 217, 37, 167, 77},
				},
				{
					Value:      17,
					PubKeyHash: []byte{42, 119, 103, 125, 35, 10, 156, 128, 129, 203, 75, 23, 182, 143, 140, 175, 165, 205, 61, 5},
				},
			},
			TimeStamp: 1744802343474,
			Payload:   []string{},
			want:      true, // 根据实际情况设置预期结果
		},
		{
			name: "test - failure",
			ID:   []byte{148, 4, 233, 44, 128, 20, 98, 94, 130, 21, 151, 171, 62, 163, 53, 174, 46, 138, 38, 19, 104, 123, 107, 216, 206, 69, 118, 14, 168, 89, 26, 65},
			Vin: []TXInput{
				{
					Txid:      []byte{242, 57, 35, 213, 209, 237, 64, 131, 116, 252, 74, 144, 101, 18, 91, 80, 151, 242, 41, 186, 34, 238, 194, 73, 222, 217, 32, 118, 58, 213, 201, 1},
					Vout:      0,
					Signature: []byte{174, 18, 124, 227, 21, 149, 154, 91, 9, 62, 180, 155, 250, 3, 218, 86, 128, 59, 202, 252, 220, 100, 211, 89, 21, 189, 250, 116, 154, 195, 219, 167, 86, 132, 88, 94, 242, 248, 177, 63, 158, 163, 247, 15, 150, 71, 78, 234, 106, 53, 71, 111, 112, 244, 177, 97, 74, 63, 64, 195, 190, 160, 40, 163},
					PubKey:    []byte{107, 50, 194, 81, 63, 40, 4, 7, 20, 102, 136, 74, 254, 30, 229, 101, 14, 147, 16, 101, 60, 93, 62, 168, 24, 152, 116, 113, 150, 200, 211, 218, 166, 160, 233, 141, 5, 186, 252, 123, 199, 95, 106, 34, 143, 167, 169, 148, 154, 49, 7, 252, 11, 2, 218, 135, 244, 73, 206, 184, 231, 157, 214, 78},
				},
			},
			Vout: []TXOutput{
				{
					Value:      3,
					PubKeyHash: []byte{187, 200, 241, 71, 145, 23, 162, 139, 36, 63, 27, 34, 107, 61, 87, 160, 217, 37, 167, 77},
				},
				{
					Value:      17,
					PubKeyHash: []byte{42, 119, 103, 125, 35, 10, 156, 128, 129, 203, 75, 23, 182, 143, 140, 175, 165, 205, 61, 5},
				},
			},
			TimeStamp: 1744803149378,
			Payload:   []string{},
			want:      true, // 根据实际情况设置预期结果
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			tx := &Transaction{
				ID:        tt.ID,
				Vin:       tt.Vin,
				Vout:      tt.Vout,
				TimeStamp: tt.TimeStamp,
				Payload:   tt.Payload,
			}
			prevTXs := map[string]Transaction{
				"f23923d5d1ed408374fc4a9065125b5097f229ba22eec249ded920763ad5c901": {
					ID: []byte{242, 57, 35, 213, 209, 237, 64, 131, 116, 252, 74, 144, 101, 18, 91, 80, 151, 242, 41, 186, 34, 238, 194, 73, 222, 217, 32, 118, 58, 213, 201, 1},
					Vin: []TXInput{
						{
							Txid:      []byte{},
							Vout:      -1,
							Signature: []byte{},
							PubKey:    []byte{},
						},
					},
					Vout: []TXOutput{
						{
							Value:      20,
							PubKeyHash: []byte{42, 119, 103, 125, 35, 10, 156, 128, 129, 203, 75, 23, 182, 143, 140, 175, 165, 205, 61, 5},
						},
					},
					TimeStamp: 1744618661623,
					Payload:   []string{"The Times 03/Jan/2009 Chancellor on brink of second bailout for banks"},
				},
			}
			if got := tx.Verify(prevTXs); got != tt.want {
				t.Errorf("Verify() = %v, want %v", got, tt.want)
			}
		})
	}
}
